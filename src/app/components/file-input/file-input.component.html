<!-- FileInput Component Template (Tailwind-only) -->
<div class="space-y-2" [class.opacity-50]="disabled">
    <!-- Label -->
    <label *ngIf="label" [for]="id" class="block text-sm font-semibold text-gray-900 dark:text-white">
        {{ label }}
        <span class="text-red-500" [class.invisible]="!isRequired">*</span>
    </label>

    <!-- Dropzone -->
    <label [for]="id" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" class="group relative block w-full cursor-pointer rounded-xl bg-white/90 dark:bg-dark/60
           ring-1 ring-inset ring-gray-300 dark:ring-white/10 p-5 sm:p-6
           transition focus-within:ring-2 focus-within:ring-sky-500
           hover:ring-sky-400" [ngClass]="{
      'ring-red-400 focus-within:ring-red-500 hover:ring-red-400': getErrors().length > 0,
      'ring-sky-500': dragActive
    }">
        <div class="flex items-center gap-4">
            <div class="h-12 w-12 grid place-items-center rounded-lg border border-dashed
               border-gray-300 dark:border-white/20
               group-hover:border-sky-400" [ngClass]="{ 'border-red-300': getErrors().length > 0 }">
                <!-- Ícono -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-300"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 16V4m0 0 4 4m-4-4-4 4" />
                    <path d="M3 16.5V18a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-1.5" />
                </svg>
            </div>

            <div class="min-w-0">
                <p class="text-sm font-medium text-gray-900 dark:text-white">
                    Arrastra y suelta {{ multiple ? 'tus archivos' : 'tu archivo' }} aquí
                    <span class="mx-1 text-gray-500 dark:text-gray-400">o</span>
                    <span class="inline-flex items-center rounded-md px-2.5 py-1
                   text-sm font-semibold text-sky-700 dark:text-sky-300
                   ring-1 ring-inset ring-gray-300 dark:ring-white/10
                   group-hover:ring-sky-400">
                        Seleccionar archivo
                    </span>
                </p>

                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                    {{ helperText || buildHelperText() }}
                </p>
            </div>
        </div>

        <!-- Input real (oculto) -->
        <input [id]="id" type="file" class="sr-only" [accept]="accept" [multiple]="multiple" [name]="name || id"
            [disabled]="disabled" [required]="isRequired" (change)="onFileChange($event)" />
    </label>

    <!-- Error -->
    @if (getErrors().length > 0) {
    <p class="text-sm text-red-600">{{ getErrors()[0].message }}</p>
    }

    <!-- Lista de archivos -->
    @if (hasFile) {
    <ul role="list"
        class="mt-3 divide-y divide-gray-200 dark:divide-white/10
             rounded-xl overflow-hidden ring-1 ring-inset ring-gray-200 dark:ring-white/10 bg-white/70 dark:bg-dark/40">
        @for (file of fileList; track file.name; let i = $index) {
        <li class="p-3 sm:p-4 flex items-center gap-4">
            <!-- Thumb / ícono -->
            <div
                class="h-12 w-12 flex items-center justify-center rounded-md ring-1 ring-inset ring-gray-200 dark:ring-white/10 overflow-hidden">
                <img *ngIf="isImage(file)" [src]="getPreviewUrl(file)" alt="" class="h-12 w-12 object-cover" />
                <i *ngIf="!isImage(file)" [class]="getFileIcon(file)"
                    class="text-xl text-gray-600 dark:text-gray-300"></i>
            </div>

            <!-- Nombre + tamaño -->
            <div class="min-w-0 flex-1">
                <p class="text-sm font-medium text-gray-900 dark:text-white truncate">{{ file.name }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">{{ formatFileSize(file.size) }}</p>
            </div>

            <!-- Acciones -->
            <div class="flex items-center gap-1.5">
                @if (showPreview && isPreviewable(file)) {
                <button type="button"
                    class="px-2 py-1 text-xs rounded-md ring-1 ring-inset ring-gray-300 dark:ring-white/10 hover:bg-gray-50 dark:hover:bg-white/10"
                    (click)="previewFile(file)" aria-label="Vista previa">
                    <i class="ti ti-eye"></i>
                </button>
                }
                @if (showDownload) {
                <button type="button"
                    class="px-2 py-1 text-xs rounded-md ring-1 ring-inset ring-gray-300 dark:ring-white/10 hover:bg-gray-50 dark:hover:bg-white/10"
                    (click)="downloadFile(file)" aria-label="Descargar">
                    <i class="ti ti-download"></i>
                </button>
                }
                @if (showDelete) {
                <button type="button"
                    class="px-2 py-1 text-xs rounded-md ring-1 ring-inset ring-gray-300 dark:ring-white/10 hover:bg-red-50 dark:hover:bg-red-500/10 text-red-600"
                    (click)="removeFile(i)" aria-label="Eliminar">
                    <i class="ti ti-trash"></i>
                </button>
                }
            </div>
        </li>
        }
    </ul>
    }
</div>
